#include <Ticker.h>
#include <PxMatrix.h>

Ticker display_ticker;

// Pins for LED MATRIX // works for ESP32 devkit
#define P_LAT 2
#define P_A 17
#define P_B 16
#define P_C 4
//#define P_D 5 // 5
#define P_OE 15

#define LEDG1 36
#define LEDG2 39
#define LEDG3 34
#define LEDG4 1
#define LEDG5 3

#define LEDR1 33
#define LEDY1 12

#define Buzzer 32

PxMATRIX display(32, 32, P_LAT, P_OE,P_A,P_B,P_C); // changed from default

uint16_t static image[] = {
0x9c0c,0x6413,0x9800,0x6000,0xf946,0xf800,0xfc06,0xfc06,0xffe0,0xffe0,0x0546,0x354c,0x0559,0x055f,0x3159,0x32b9,   // (16) pixels
0x9ab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (32) pixels
0x6413,0x9c0c,0x9806,0x9800,0xc806,0xf946,0xfc06,0xfc00,0xffe0,0xffe0,0x354c,0x0546,0x055f,0x0559,0x32b9,0x6159,   // (48) pixels
0x9ab3,0x9959,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (64) pixels
0x9c13,0x640c,0x6006,0x9800,0xc946,0xf800,0xfc06,0xfc06,0xfea0,0xffe0,0x3546,0x354c,0x0559,0x055f,0x3159,0x32b9,   // (80) pixels
0x9ab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (96) pixels
0x640c,0x9c13,0x9800,0x9800,0xf946,0xc946,0xfc06,0xfc00,0xffe0,0xffe0,0x054c,0x3546,0x055f,0x055f,0x32b9,0x6159,   // (112) pixels
0x9ab3,0xc953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (128) pixels
0x6413,0x9c0c,0x6006,0x9800,0xc946,0xf800,0xfc06,0xfc06,0xfea0,0xffe0,0x0546,0x3546,0x055f,0x0559,0x3159,0x32b9,   // (144) pixels
0x9ab9,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (160) pixels
0x9c0c,0x6413,0x9800,0x6006,0xf806,0xf946,0xfc06,0xfc00,0xffe0,0xffe0,0x354c,0x054c,0x0559,0x055f,0x62b9,0x3159,   // (176) pixels
0x9ab3,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (192) pixels
0x9c0c,0x6413,0x9800,0x9800,0xf946,0xc800,0xfc06,0xfc06,0xfea0,0xffe0,0x3546,0x3546,0x055f,0x0559,0x3159,0x32b9,   // (208) pixels
0xcab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (224) pixels
0x6413,0x9c0c,0x6006,0x9800,0xc946,0xf946,0xfc06,0xfc06,0xffe0,0xffe0,0x054c,0x3546,0x055f,0x055f,0x3159,0x32b9,   // (240) pixels
0x9953,0x9ab9,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (256) pixels
0x9c0c,0x6413,0x9800,0x6000,0xf946,0xf800,0xfc06,0xfc00,0xfea0,0xffe0,0x054c,0x3546,0x041f,0x0559,0x32b9,0x32b9,   // (272) pixels
0xcab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (288) pixels
0x6413,0x9c0c,0x9806,0x6000,0xf806,0xc946,0xfc06,0xfc06,0xffe0,0xffe0,0x3546,0x054c,0x0559,0x055f,0x6159,0x32b9,   // (304) pixels
0x9953,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (320) pixels
0x9c0c,0x6413,0x9800,0x6006,0xf800,0xf946,0xfc00,0xfaa6,0xffe0,0xffe0,0x354c,0x3546,0x055f,0x0559,0x3159,0x32b9,   // (336) pixels
0x9ab9,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (352) pixels
0x6413,0x9c0c,0x9800,0x9806,0xc946,0xf940,0xfc06,0xfc06,0xffe0,0xfea0,0x0546,0x354c,0x055f,0x0559,0x32b9,0x6159,   // (368) pixels
0x9ab3,0xcab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (384) pixels
0x9c13,0x640c,0x9806,0x6000,0xf940,0xc806,0xfc06,0xfc06,0xffe0,0xffe0,0x054c,0x3546,0x0559,0x055f,0x3159,0x32b9,   // (400) pixels
0x9ab3,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (416) pixels
0x640c,0x9c13,0x6000,0x9806,0xf806,0xf940,0xfc06,0xfc00,0xffe0,0xffe0,0x3546,0x054c,0x055f,0x0559,0x32b9,0x6159,   // (432) pixels
0x9ab3,0x9ab9,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (448) pixels
0x9c0c,0x6413,0x9800,0x6000,0xf946,0xc806,0xfc06,0xfc06,0xfea0,0xffe0,0x354c,0x3546,0x0559,0x055f,0x32b9,0x32b9,   // (464) pixels
0x9953,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (480) pixels
0x6413,0x9c0c,0x9806,0x9800,0xf946,0xc940,0xfc06,0xfc06,0xffe0,0xffe0,0x0546,0x354c,0x055f,0x0419,0x62b9,0x3159,   // (496) pixels
0xcab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (512) pixels
0x9c0c,0x6413,0x6000,0x9800,0xc946,0xf806,0xfc00,0xfc06,0xfea0,0xffe0,0x054c,0x3546,0x0559,0x055f,0x32b9,0x32b9,   // (528) pixels
0x9ab9,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (544) pixels
0x6413,0x9c0c,0x9806,0x6000,0xf806,0xf946,0xfc06,0xfc06,0xffe0,0xffe0,0x3546,0x054c,0x055f,0x0419,0x32b9,0x3159,   // (560) pixels
0xcab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (576) pixels
0x640c,0x9c13,0x6000,0x9806,0xf940,0xc806,0xfc00,0xfc06,0xfea0,0xffe0,0x354c,0x3546,0x0559,0x055f,0x6159,0x32b9,   // (592) pixels
0x9ab3,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (608) pixels
0x9c13,0x640c,0x9800,0x9800,0xc946,0xf946,0xfc06,0xfc00,0xffe0,0xffe0,0x0546,0x354c,0x055f,0x0559,0x32b9,0x3159,   // (624) pixels
0xcab9,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (640) pixels
0x9c0c,0x6413,0x9806,0x6000,0xf946,0xf800,0xfc06,0xfc06,0xfea0,0xffe0,0x0546,0x354c,0x0559,0x055f,0x32b9,0x32b9,   // (656) pixels
0x9ab3,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (672) pixels
0x6413,0x9c0c,0x6000,0x9806,0xf806,0xc946,0xfc06,0xfc00,0xffe0,0xffe0,0x354c,0x0546,0x055f,0x041f,0x32b9,0x6159,   // (688) pixels
0x9ab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (704) pixels
0x9c0c,0x6413,0x9800,0x9800,0xc946,0xf800,0xfc06,0xfc06,0xfea0,0xffe0,0x354c,0x3546,0x055f,0x0559,0x3159,0x32b9,   // (720) pixels
0x9ab9,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (736) pixels
0x6413,0x9c0c,0x6006,0x9800,0xf946,0xc946,0xfc00,0xfc06,0xffe0,0xffe0,0x0546,0x354c,0x0559,0x055f,0x32b9,0x6159,   // (752) pixels
0x9ab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (768) pixels
0x9c0c,0x6413,0x9800,0x9806,0xc940,0xf806,0xfc06,0xfc06,0xfea0,0xffe0,0x054c,0x3546,0x055f,0x0559,0x3159,0x32b9,   // (784) pixels
0xcab3,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (800) pixels
0x6413,0x9c0c,0x6000,0x9800,0xf806,0xc946,0xfc00,0xfc06,0xffe0,0xffe0,0x3546,0x054c,0x0559,0x055f,0x32b9,0x3159,   // (816) pixels
0x9ab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (832) pixels
0x9c0c,0x6413,0x9806,0x6000,0xf946,0xf800,0xfc06,0xfc06,0xfea0,0xffe0,0x354c,0x3546,0x055f,0x0559,0x6159,0x32b9,   // (848) pixels
0xcab9,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (864) pixels
0x6413,0x9c0c,0x9800,0x6006,0xf946,0xc946,0xfc06,0xfc00,0xffe0,0xffe0,0x0546,0x354c,0x055f,0x0559,0x32b9,0x3159,   // (880) pixels
0x9ab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (896) pixels
0x9c0c,0x6413,0x9800,0x6000,0xf946,0xf800,0xfc06,0xfc06,0xfea0,0xffe0,0x054c,0x3546,0x0559,0x055f,0x3159,0x32b9,   // (912) pixels
0x9ab3,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (928) pixels
0x6413,0x9c0c,0x9806,0x9800,0xc806,0xf946,0xfc00,0xfc06,0xffe0,0xffe0,0x3546,0x054c,0x055f,0x0559,0x62b9,0x3159,   // (944) pixels
0xcab3,0x9ab9,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (960) pixels
0x9c0c,0x6413,0x6000,0x9800,0xc946,0xf800,0xfc06,0xfc06,0xfea0,0xffe0,0x354c,0x3546,0x0559,0x055f,0x3159,0x32b9,   // (976) pixels
0x9ab3,0x9953,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,   // (992) pixels
0x6413,0x9c0c,0x9806,0x6000,0xf946,0xf946,0xfc06,0xfc00,0xffe0,0xffe0,0x0546,0x354c,0x055f,0x0559,0x3159,0x32b9,   // (1008) pixels
0xcab3,0x9ab3,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff,0xffff   // (1024) pixels
};



// ISR for display refresh
void display_updater()
{
  display.display(10);
}

void setup() {
  Serial.begin(115200);
  for (int i = 0; i < 1024; i++) {Serial.println(image[i], HEX);}
  display.begin(8, 14, 13, 5, 23); //(row_pattern, CLK, MOSI, MISO, SS)
  display.clearDisplay();
  display_ticker.attach(0.002, display_updater);
  yield();
  display.clearDisplay();
  drawImage(0, 0);
  delay(500);

  pinMode(LEDG1, OUTPUT);
  pinMode(LEDG2, OUTPUT);
  pinMode(LEDG3, OUTPUT);
  pinMode(LEDG4, OUTPUT);
  pinMode(LEDG5, OUTPUT);

  pinMode(LEDR1, OUTPUT);
  pinMode(LEDY1, OUTPUT);

  pinMode(Buzzer, OUTPUT);

}

void drawImage(int x, int y)
{
  int imageHeight = 32;
  int imageWidth = 32;
  int counter = 0;
  for (int yy = 0; yy < imageHeight; yy++)
  {
    for (int xx = 0; xx < imageWidth; xx++)
    {
      display.drawPixel(xx + x , yy + y, image[counter]);
      counter++;
    }
  }
}

void drawFrame(uint16_t *frame) {
  display.clearDisplay();
  int imageHeight = 32;
  int imageWidth = 64;
  int counter = 0;
  for (int yy = 0; yy < imageHeight; yy++) {
    for (int xx = 0; xx < imageWidth; xx++) {
      display.drawPixel(xx, yy, frame[counter]);
      counter++;
    }
  }
  delay(100);
}

void loop() {
  digitalWrite(LEDG1, HIGH);
  delay(500);
  digitalWrite(LEDG2, HIGH);
  delay(500);
  digitalWrite(LEDG3, HIGH);
  delay(500);
  digitalWrite(LEDG4, HIGH);
  delay(500);
  digitalWrite(LEDG5, HIGH);
  delay(500);
  digitalWrite(LEDR1, HIGH);
  delay(500);
  digitalWrite(LEDY1, HIGH);
  delay(500);
  //digitalWrite(Buzzer, HIGH);
  //delay(500);
  digitalWrite(LEDG1, LOW);
  digitalWrite(LEDG2, LOW);
  digitalWrite(LEDG3, LOW);
  digitalWrite(LEDG4, LOW);
  digitalWrite(LEDG5, LOW);
  digitalWrite(LEDR1, LOW);
  digitalWrite(LEDY1, LOW);
  digitalWrite(Buzzer, LOW);
}
